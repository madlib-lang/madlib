#!/bin/bash
mkdir .buildlibs
mkdir -p runtime/lib
cd .buildlibs

wget https://github.com/libuv/libuv/archive/refs/tags/v1.42.0.zip
unzip v1.42.0.zip -d libuv
cd libuv/libuv-1.42.0 && sh autogen.sh && ./configure --enable-static && make -j
cd ../..
cp libuv/libuv-1.42.0/.libs/libuv.a ../runtime/lib/libuv.a
cp -R libuv/libuv-1.42.0/include ../runtime/

# install libgc
wget https://github.com/ivmai/bdwgc/archive/refs/tags/v8.0.6.zip
unzip v8.0.6.zip -d libgc
cd libgc/bdwgc-8.0.6 && git clone git://github.com/ivmai/libatomic_ops.git && make -f Makefile.direct
cd ../..
cp libgc/bdwgc-8.0.6/gc.a ../runtime/lib/libgc.a
cp -R libgc/bdwgc-8.0.6/include ../runtime/

cd ..
rm -rf .buildlibs
